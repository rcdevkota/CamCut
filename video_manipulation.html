<!DOCTYPE html>
<html>
    <head>
        <style>
            body {
                background: black;
                color: #CCCCCC;
            }

            div {
                float: left;
                border: 1px solid #444444;
                padding: 10px;
                margin: 10px;
                background: #3B3B3B;
            }
        </style>
    </head>

    <body >
        <button disabled id=btn>SAVE TO GREY</button> (click then scroll down to see result)<br>
        <canvas id=c></canvas><br><img id=demo>
        <script type="text/javascript">
            var ctx = c.getContext("2d"), img = new Image;
            img.onload = setup;  img.crossOrigin = "";
            img.src = "http://i.imgur.com/OrYVGI8.jpg";

            function setup() {
            c.width = this.naturalWidth;  c.height = this.naturalHeight;
            ctx.drawImage(this, 0, 0);    btn.disabled = false
            }

            // Main code for demo
            btn.onclick = function() {
            
            var idataSrc = ctx.getImageData(0, 0, c.width, c.height), // original
                idataTrg = ctx.createImageData(c.width, c.height),    // empty data
                dataSrc = idataSrc.data,                              // reference the data itself
                dataTrg = idataTrg.data,
                len = dataSrc.length, i = 0, luma;
            
            // convert by iterating over each pixel each representing RGBA
            for(; i < len; i += 4) {
                // calculate luma, here using Rec 709
                luma = dataSrc[i] * 0.2126 + dataSrc[i+1] * 0.7152 + dataSrc[i+2] * 0.0722;

                // update target's RGB using the same luma value for all channels
                dataTrg[i] = dataTrg[i+1] = dataTrg[i+2] = luma;
                dataTrg[i+3] = dataSrc[i+3];                            // copy alpha
            }
            
            // put back luma data so we can save it as image
            ctx.putImageData(idataTrg, 0, 0);
            demo.src = c.toDataURL();                                 // set demo result's src url
            
            // restore backup data
            ctx.putImageData(idataSrc, 0, 0);
            };
        </script>

    </body>
</html>